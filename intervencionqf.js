javascript:(function(){var mId='sam_v6',d=document,g=i=>d.getElementById(i);if(g(mId))g(mId).remove();var m=d.createElement('div');m.id=mId;m.style='position:fixed;top:5%;left:55%;z-index:99999;width:400px;height:600px;min-width:300px;background:#fff;border:2px solid #004589;padding:0;font-family:sans-serif;box-shadow:0 8px 30px rgba(0,0,0,0.5);border-radius:10px;overflow:hidden;display:flex;flex-direction:column;resize:both;';var h=d.createElement('div');h.style='padding:10px;background:#004589;color:#fff;cursor:move;font-weight:bold;user-select:none;display:flex;justify-content:space-between;flex-shrink:0;';h.innerHTML='<span>SAM Assistant</span><div><span id="min" style="cursor:pointer;margin-right:10px">_</span><span id="cls" style="cursor:pointer">×</span></div>';m.appendChild(h);var b=d.createElement('div');b.style='padding:10px;overflow:hidden;flex-grow:1;display:flex;flex-direction:column;background:#f4f4f4;';m.appendChild(b);d.body.appendChild(m);g('cls').onclick=()=>m.remove();g('min').onclick=()=>{b.style.display=b.style.display==='none'?'flex':'none';m.style.height=b.style.display==='none'?'auto':'600px'};var p1=0,p2=0,p3=0,p4=0;h.onmousedown=e=>{e.preventDefault();p3=e.clientX;p4=e.clientY;d.onmouseup=()=>{d.onmouseup=null;d.onmousemove=null};d.onmousemove=e=>{e.preventDefault();p1=p3-e.clientX;p2=p4-e.clientY;p3=e.clientX;p4=e.clientY;m.style.top=(m.offsetTop-p2)+'px';m.style.left=(m.offsetLeft-p1)+'px'}};var getToday=()=>{var t=new Date();return String(t.getDate()).padStart(2,'0')+'-'+String(t.getMonth()+1).padStart(2,'0')+'-'+t.getFullYear()};var fill=(typ)=>{var f=g('fecha'),srv=g('servicio'),rev=g('revisado'),sav=localStorage.getItem('sam_map'),da=g('sd').value;localStorage.setItem('sam_date',da);if(f)f.value=da;if(srv)srv.value=sav||"1";if(rev)rev.value=typ;[f,srv,rev].forEach(el=>{if(el)el.style.background='#c8e6c9'})};var renderList=(data)=>{var curD=localStorage.getItem('sam_date')||getToday();b.innerHTML='<div style="flex-shrink:0;margin-bottom:5px;display:flex;justify-content:space-between;align-items:center"><b style="color:#004589">FECHA:</b><input id="sd" value="'+curD+'" style="width:120px;text-align:center;border:1px solid #ccc;padding:2px;"></div><div style="flex-grow:1;display:flex;flex-direction:column;min-height:150px"><input id="f" placeholder="Filtrar paciente..." style="width:100%;margin-bottom:5px;box-sizing:border-box"><select id="l" size="10" style="width:100%;font-size:11px;flex-grow:1;border:1px solid #999;"></select><button id="bi" style="width:100%;height:35px;background:#004589;color:#fff;border:none;margin-top:5px;cursor:pointer;font-weight:bold">BUSCAR FICHA</button></div><div style="flex-shrink:0;margin-top:10px;border-top:2px solid #ccc;padding-top:10px"><b style="color:#555;font-size:11px">MENÚ DE ACCIONES:</b><select id="menuSel" style="width:100%;margin:5px 0;padding:5px"><option value="mon">1. Monitorizaciones</option><option value="fut" disabled>2. (Futuro...)</option></select><div id="deck" style="background:#e9ecef;padding:8px;border-radius:5px;border:1px solid #ccc"></div><button id="rst" style="width:100%;margin-top:8px;border:none;color:#d9534f;cursor:pointer;font-size:10px;background:none">Cambiar Servicio (Reset)</button></div>';var sl=g('l'),it=g('f'),deck=g('deck');var re=q=>{sl.innerHTML='';data.filter(x=>x.n.toLowerCase().includes(q.toLowerCase())).forEach(x=>{var o=d.createElement('option');o.value=x.f;o.text=x.n;sl.add(o)})};it.oninput=e=>re(e.target.value);re('');var loadDeck=()=>{var v=g('menuSel').value;if(v==='mon'){deck.innerHTML='<div style="display:flex;gap:5px"><button id="btnI" style="flex:1;height:40px;background:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer;font-weight:bold;font-size:11px">I. MONITORIZACION</button><button id="btnN" style="flex:1;height:40px;background:#17a2b8;color:#fff;border:none;border-radius:4px;cursor:pointer;font-weight:bold;font-size:11px">N. REVISION</button></div>';g('btnI').onclick=()=>fill('I');g('btnN').onclick=()=>fill('N')}};g('menuSel').onchange=loadDeck;loadDeck();g('rst').onclick=()=>{localStorage.removeItem('sam_cache');localStorage.removeItem('sam_date');init()};g('bi').onclick=()=>{if(!sl.value)return;var h=g('ficha');if(h){h.value=sl.value;h.focus();if(typeof validar==='function')validar()}}};var fetchS=async(id,map)=>{b.innerHTML='<small>Cargando...</small>';try{var r=await fetch('http://10.7.33.28/hlcm6/atehos002.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'ser='+id});var t=await r.text(),p=new DOMParser().parseFromString(t,'text/html'),tbls=p.querySelectorAll('table'),rs=Array.from((tbls[1]||tbls[0]).querySelectorAll('tr')).slice(1),da=rs.map(r=>{var c=r.querySelectorAll('td');return(c.length>7)?{f:c[5].innerText.trim(),n:c[7].innerText.trim()}:null}).filter(x=>x);localStorage.setItem('sam_cache',JSON.stringify(da));localStorage.setItem('sam_map',map);renderList(da)}catch(e){alert(e);init()}};var init=()=>{var cache=localStorage.getItem('sam_cache');if(cache){renderList(JSON.parse(cache));return}b.innerHTML='<b style="color:#004589">SELECCIONE SERVICIO</b><select id="v" size="14" style="width:100%;margin:8px 0;font-size:11px;flex-grow:1"><option value="75" data-map="2" style="font-weight:bold;color:#004589">ONCOLOGIA</option><option value="86" data-map="1" style="font-weight:bold;color:#004589">UPC PEDIATRICA</option><option value="3221" data-map="5" style="font-weight:bold;color:#004589">2da INFANCIA</option><option value="78" data-map="3" style="font-weight:bold;color:#004589">UTI TPH</option><option value="82" data-map="4" style="font-weight:bold;color:#004589">UPC CARDIOVASCULAR</option><option value="83" data-map="12" style="font-weight:bold;color:#004589">UPC NEONATAL</option><option value="3190" data-map="3" style="font-weight:bold;color:#004589">CAE TRASPLANTE MEDULA</option><option disabled>----------------</option><option value="74" data-map="10">LACTANTES</option><option value="73" data-map="6">CIRUGIA</option><option value="3176" data-map="6">HOSP DIA QUIRURGICO</option><option value="61" data-map="11">PENSIONADO</option><option value="15" data-map="6">DIALISIS</option><option value="62" data-map="6">PSICUIATRIA</option><option value="3403" data-map="6">AGUDO INDIF. B</option><option value="3268" data-map="1">UAI PEDIATRICO</option><option value="80" data-map="6">URGENCIA</option></select><button id="go" style="width:100%;height:40px;background:#004589;color:#fff;border:none;border-radius:5px;cursor:pointer;flex-shrink:0">CARGAR LISTA</button>';g('go').onclick=()=>{var el=g('v'),opt=el.options[el.selectedIndex];if(!opt)return;fetchS(el.value,opt.getAttribute('data-map'))}};init()})();